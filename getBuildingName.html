
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>simpleMap</title>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script
	src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=l7xx2c101ec10b184ce38225574befab7376"></script>
<script type="text/javascript">
	var map, marker;
	function initTmap() {

		// 1. 지도 띄우기
		map = new Tmapv2.Map("map_div", {
			center : new Tmapv2.LatLng(37.570028, 126.986072),
			width : "100%",
			height : "400px",
			zoom : 15,
			zoomControl : true,
			scrollwheel : true

		});

		// 마커 초기화
		marker1 = new Tmapv2.Marker(
				{
					icon : "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_a.png",
					iconSize : new Tmapv2.Size(24, 38),
					map : map
				});

		// 2. API 사용요청
		var lon, lat;

		map.addListener(
						"click",
						async function onClick(evt) {
							var mapLatLng = evt.latLng;

							//기존 마커 삭제
							marker1.setMap(null);

							var markerPosition = new Tmapv2.LatLng(
									mapLatLng._lat, mapLatLng._lng);
							//마커 올리기
							marker1 = new Tmapv2.Marker(
									{
										position : markerPosition,
										icon : "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_p.png",
										iconSize : new Tmapv2.Size(24, 38),
										map : map
									});

							res = await getBuildingName(mapLatLng._lng, mapLatLng._lat);
							res = res.addressInfo;
							var buildingName;
							if(res.buildingName.length != 0) {
								buildingName = res.buildingName;
							} else {
								buildingName = res.gu_gun + ' '+ res.roadName + ' '+res.buildingIndex;
							}
							console.log(buildingName);
						});

		function getBuildingName(lon, lat) {
			return $.ajax({
						method : "GET",
						url : "https://apis.openapi.sk.com/tmap/geo/reversegeocoding?version=1&format=json&callback=result",
						async : false,
						data : {
							"appKey" : "l7xx2c101ec10b184ce38225574befab7376",
							"coordType" : "WGS84GEO",
							"addressType" : "A10",
							"lon" : lon,
							"lat" : lat
						},
						error : function(request, status, error) {
							console.log("code:" + request.status + "\n"
									+ "message:" + request.responseText + "\n"
									+ "error:" + error);
						}
					});

		}
	}
</script>
</head>
<body onload="initTmap();">
	<p id="result"></p>
	<div id="map_wrap" class="map_wrap3">
		<div id="map_div"></div>
	</div>
	<div class="map_act_btn_wrap clear_box"></div>
</body>
</html>

			